(()=>{var e={};e.id=178,e.ids=[178],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},85477:e=>{"use strict";e.exports=require("punycode")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},38058:(e,r,t)=>{"use strict";t.r(r),t.d(r,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>p,routeModule:()=>f,tree:()=>d});var s=t(73137),i=t(54647),a=t(4183),n=t.n(a),o=t(71775),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(r,l);let c=s.AppPageRouteModule,d=["",{children:["profile",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,70503)),"/Users/konstantinoslepidas/Desktop/football/app/profile/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,58022)),"/Users/konstantinoslepidas/Desktop/football/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,51918,23)),"next/dist/client/components/not-found-error"]}],p=["/Users/konstantinoslepidas/Desktop/football/app/profile/page.tsx"],u="/profile/page",m={require:t,loadChunk:()=>Promise.resolve()},f=new c({definition:{kind:i.x.APP_PAGE,page:"/profile/page",pathname:"/profile",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},4286:(e,r,t)=>{Promise.resolve().then(t.bind(t,2830))},2830:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>E});var s=t(60080),i=t(9885),a=t(66558),n=t(83894),o=t(19098),l=t(43334),c=t(68384),d=t(46701),p=t(49424),u=t(66698),m=t(70345),f=t(23161);let x=i.forwardRef(({className:e,...r},t)=>(0,s.jsxs)(m.fC,{ref:t,className:(0,f.cn)("relative flex w-full touch-none select-none items-center",e),...r,children:[s.jsx(m.fQ,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:s.jsx(m.e6,{className:"absolute h-full bg-primary"})}),s.jsx(m.bU,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));x.displayName=m.fC.displayName;var h=t(87502),g=t(97052),b=t(32293),j=t(33478),v=t(2091),w=t(92861),y=t.n(w),N=t(12932),_=t(87742),P=t.n(_);let q=async()=>{try{let e=await P().Notifications.permission;if(console.log("Current permission:",e),!e){let e=await P().Slidedown.promptPush();console.log("Prompt result:",e);let r=await P().Notifications.permission;if(console.log("New permission:",r),!r)return!1}await P().User.PushSubscription.optIn();let r=await P().User.PushSubscription.optedIn;console.log("Is subscribed:",r);let t=await P().Notifications.permission;return console.log("Final browser permission:",t),!!(r&&t)}catch(e){return console.error("Error subscribing to notifications:",e),!1}},k=async()=>{try{await P().User.PushSubscription.optOut();let e=await P().User.PushSubscription.optedIn;return console.log("Is still subscribed:",e),!e}catch(e){return console.error("Error unsubscribing from notifications:",e),!1}},C=async()=>{try{let e=await P().Notifications.permission,r=await P().User.PushSubscription.optedIn;return console.log("Permission:",e,"Push enabled:",r),e&&r?"granted":"denied"}catch(e){return console.error("Error getting notification status:",e),"denied"}},S=o.Ry({username:o.Z_().min(3,"Username must be at least 3 characters").max(20,"Username must be less than 20 characters").regex(/^[a-zA-Z0-9_]+$/,"Username can only contain letters, numbers and underscores"),phone_number:o.Z_().optional(),phone_public:o.O7().default(!1),notifications_enabled:o.O7().default(!1),speed:o.Rx().min(1).max(5),pace:o.Rx().min(1).max(5),power:o.Rx().min(1).max(5)});function E(){let[e,r]=(0,i.useState)(!0),[t,o]=(0,i.useState)(null),[m,f]=(0,i.useState)(null),[w,_]=(0,i.useState)(null),[P,E]=(0,i.useState)("default"),I=(0,l.createClientComponentClient)(),{toast:U}=(0,h.pm)(),{t:F}=(0,N.useLanguage)(),R=(0,a.cI)({resolver:(0,n.F)(S),defaultValues:{username:"",phone_number:"",phone_public:!1,notifications_enabled:!1,speed:3,pace:3,power:3}}),W=(R.watch("speed")+R.watch("pace")+R.watch("power"))/3;(0,i.useEffect)(()=>{let e=async()=>{try{let{data:{user:e}}=await I.auth.getUser();if(!e)return;let{data:r}=await I.from("profiles").select("*").eq("id",e.id).single(),t=await C();E(t);let{data:s}=await I.from("match_ratings").select("rating").eq("rated_player_id",e.id);if(r&&(o(r),R.reset({username:r.username||"",phone_number:r.phone_number||"",phone_public:r.phone_public||!1,notifications_enabled:"granted"===t,speed:r.speed||3,pace:r.pace||3,power:r.power||3}),s&&s.length>0)){let e=s.reduce((e,r)=>e+r.rating,0)/s.length;_(Number(e.toFixed(1)))}}catch(e){console.error("Error fetching profile:",e)}finally{r(!1)}};e()},[]);let G=async e=>{try{let{data:{user:r}}=await I.auth.getUser();if(!r)return;let s=e.name.split(".").pop()?.toLowerCase();if(!s||!["jpg","jpeg","png","gif"].includes(s))throw Error("Invalid file type. Please upload a JPG, PNG, or GIF image.");let i=await y()(e,{maxSizeMB:1,maxWidthOrHeight:800,useWebWorker:!0}),a=`${r.id}.${s}`;await I.storage.from("avatars").remove([a]);let{error:n}=await I.storage.from("avatars").upload(a,i,{upsert:!0,contentType:`image/${s}`});if(n)throw n;let{data:{publicUrl:l}}=I.storage.from("avatars").getPublicUrl(a);await I.from("profiles").update({avatar_url:l}).eq("id",r.id),o({...t,avatar_url:l}),U({title:"Success",description:"Profile picture updated"})}catch(e){console.error("Error uploading avatar:",e),U({title:"Error",description:e instanceof Error?e.message:"Failed to upload profile picture",variant:"destructive"})}},J=async e=>{try{let{data:{user:r}}=await I.auth.getUser();if(!r)return;let{data:t,error:s}=await I.from("profiles").select("id").eq("username",e.username).neq("id",r.id);if(s)throw s;if(t&&t.length>0){R.setError("username",{type:"manual",message:"Username is already taken"});return}let{error:i}=await I.from("profiles").update({username:e.username,phone_number:e.phone_number,phone_public:e.phone_public,speed:e.speed,pace:e.pace,power:e.power}).eq("id",r.id);if(i)throw i;U({title:"Success",description:"Profile updated successfully"})}catch(e){console.error("Error updating profile:",e),U({title:"Error",description:"Failed to update profile",variant:"destructive"})}};return e?s.jsx("div",{className:"p-4",children:"Loading..."}):s.jsx("div",{className:"p-4 space-y-6",children:(0,s.jsxs)(g.Zb,{children:[s.jsx(g.Ol,{children:s.jsx(g.ll,{children:F("profile.title")})}),(0,s.jsxs)(g.aY,{className:"space-y-6",children:[s.jsx("div",{className:"flex flex-col items-center",children:(0,s.jsxs)("div",{className:"relative group cursor-pointer",children:[(0,s.jsxs)(b.qE,{className:"h-24 w-24",children:[s.jsx(b.F$,{src:t?.avatar_url}),s.jsx(b.Q5,{children:t?.full_name?.[0]||"?"})]}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity",children:s.jsx("label",{htmlFor:"avatar-upload",className:"text-xs text-white cursor-pointer",children:F("profile.changePhoto")})}),s.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",className:"hidden",onChange:e=>{let r=e.target.files?.[0];r&&G(r)}})]})}),(0,s.jsxs)("div",{className:"space-y-1",children:[s.jsx("p",{className:"text-sm font-medium",children:F("profile.fullName")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:t?.full_name||F("profile.notSet")})]}),s.jsx(d.l0,{...R,children:(0,s.jsxs)("form",{onSubmit:R.handleSubmit(J),className:"space-y-6",children:[s.jsx(d.Wi,{control:R.control,name:"username",render:({field:e})=>(0,s.jsxs)(d.xJ,{children:[s.jsx(d.lX,{children:F("profile.username")}),s.jsx(d.NI,{children:s.jsx(p.I,{placeholder:"Enter username",...e})}),s.jsx(d.zG,{})]})}),s.jsx(d.Wi,{control:R.control,name:"phone_number",render:({field:e})=>(0,s.jsxs)(d.xJ,{children:[s.jsx(d.lX,{children:F("profile.phoneNumber.label")}),s.jsx(d.NI,{children:s.jsx(p.I,{placeholder:F("profile.phoneNumber.placeholder"),...e})}),s.jsx(d.zG,{})]})}),s.jsx(d.Wi,{control:R.control,name:"phone_public",render:({field:e})=>(0,s.jsxs)(d.xJ,{className:"flex items-center justify-between rounded-lg border p-4",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[s.jsx(d.lX,{className:"text-base",children:F("profile.sharePhone")}),s.jsx(d.pf,{children:F("profile.sharePhoneDesc")})]}),s.jsx(d.NI,{children:s.jsx(u.r,{checked:e.value,onCheckedChange:e.onChange})})]})}),s.jsx(d.Wi,{control:R.control,name:"notifications_enabled",render:({field:e})=>(0,s.jsxs)(d.xJ,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[s.jsx(d.lX,{className:"text-base",children:"Push Notifications"}),s.jsx(d.pf,{children:"Receive notifications about new matches"})]}),s.jsx(d.NI,{children:s.jsx(u.r,{checked:e.value,onCheckedChange:async r=>{if(t?.id)try{if(r){let r=await q();if(r){e.onChange(!0);let{error:r}=await I.from("profiles").update({notifications_enabled:!0}).eq("id",t.id);if(r)throw r;U({title:"Success",description:"Notifications enabled successfully"})}else U({title:"Notification Error",description:"Failed to enable notifications. Please check your browser settings and try again.",variant:"destructive"})}else{let r=await k();if(r){e.onChange(!1);let{error:r}=await I.from("profiles").update({notifications_enabled:!1}).eq("id",t.id);if(r)throw r;U({title:"Success",description:"Notifications disabled successfully"})}}}catch(e){console.error("Error updating notification settings:",e),U({title:"Error",description:"Failed to update notification settings",variant:"destructive"})}}})})]})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(j._,{children:F("profile.ratings.speed.value").replace("{value}",R.watch("speed").toString())}),s.jsx(d.Wi,{control:R.control,name:"speed",render:({field:e})=>s.jsx(d.xJ,{children:s.jsx(d.NI,{children:s.jsx(x,{min:1,max:5,step:1,value:[e.value],onValueChange:([r])=>e.onChange(r)})})})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(j._,{children:F("profile.ratings.pace.value").replace("{value}",R.watch("pace").toString())}),s.jsx(d.Wi,{control:R.control,name:"pace",render:({field:e})=>s.jsx(d.xJ,{children:s.jsx(d.NI,{children:s.jsx(x,{min:1,max:5,step:1,value:[e.value],onValueChange:([r])=>e.onChange(r)})})})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx(j._,{children:F("profile.ratings.power.value").replace("{value}",R.watch("power").toString())}),s.jsx(d.Wi,{control:R.control,name:"power",render:({field:e})=>s.jsx(d.xJ,{children:s.jsx(d.NI,{children:s.jsx(x,{min:1,max:5,step:1,value:[e.value],onValueChange:([r])=>e.onChange(r)})})})})]}),(0,s.jsxs)("div",{className:"pt-2 border-t",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[s.jsx("p",{className:"font-medium",children:F("profile.selfRating")}),s.jsx("p",{className:"text-lg font-semibold",children:W.toFixed(1)})]}),w?(0,s.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[s.jsx("p",{className:"font-medium",children:F("profile.communityRating")}),(0,s.jsxs)("div",{className:"text-right",children:[s.jsx(v.Z,{rating:w}),s.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:F("profile.basedOnFeedback")})]})]}):(0,s.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[s.jsx("p",{className:"font-medium",children:F("profile.communityRating")}),s.jsx("p",{className:"text-sm text-muted-foreground",children:F("profile.noRatingsYet")})]})]})]}),s.jsx(c.z,{type:"submit",className:"w-full",children:F("profile.updateProfile")})]})})]})]})})}},70503:(e,r,t)=>{"use strict";t.r(r),t.d(r,{$$typeof:()=>n,__esModule:()=>a,default:()=>l});var s=t(17536);let i=(0,s.createProxy)(String.raw`/Users/konstantinoslepidas/Desktop/football/app/profile/page.tsx`),{__esModule:a,$$typeof:n}=i,o=i.default,l=o}};var r=require("../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[650,125,129,418,410,617,52,293,976,91],()=>t(38058));module.exports=s})();