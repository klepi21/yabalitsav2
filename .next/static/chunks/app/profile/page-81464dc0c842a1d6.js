(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{8042:(e,r,a)=>{Promise.resolve().then(a.bind(a,5862))},5862:(e,r,a)=>{"use strict";a.r(r),a.d(r,{default:()=>R});var s=a(5155),l=a(2115),t=a(9606),n=a(2679),i=a(3415),o=a(9806),c=a(4085),d=a(4839),u=a(2336),p=a(2581),m=a(5900),h=a(9602);let f=l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,s.jsxs)(m.bL,{ref:r,className:(0,h.cn)("relative flex w-full touch-none select-none items-center",a),...l,children:[(0,s.jsx)(m.CC,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:(0,s.jsx)(m.Q6,{className:"absolute h-full bg-primary"})}),(0,s.jsx)(m.zi,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]})});f.displayName=m.bL.displayName;var x=a(241),j=a(5007),g=a(4920);let v=l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,s.jsx)(g.bL,{ref:r,className:(0,h.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...l})});v.displayName=g.bL.displayName;let b=l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,s.jsx)(g._V,{ref:r,className:(0,h.cn)("aspect-square h-full w-full",a),...l})});b.displayName=g._V.displayName;let N=l.forwardRef((e,r)=>{let{className:a,...l}=e;return(0,s.jsx)(g.H4,{ref:r,className:(0,h.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...l})});N.displayName=g.H4.displayName;var w=a(5785),y=a(865);function _(e){let{rating:r,showValue:a=!0,size:l="md"}=e,t={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"};return(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(e=>(0,s.jsx)(y.A,{className:"".concat(t[l]," ").concat(e<=r?"fill-primary text-primary":"text-muted-foreground")},e)),a&&(0,s.jsxs)("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",r,")"]})]})}var C=a(5805),k=a(3367);let E=i.Ik({username:i.Yj().min(3,"Username must be at least 3 characters").max(20,"Username must be less than 20 characters").regex(/^[a-zA-Z0-9_]+$/,"Username can only contain letters, numbers and underscores"),phone_number:i.Yj().optional(),phone_public:i.zM().default(!1),speed:i.ai().min(1).max(5),pace:i.ai().min(1).max(5),power:i.ai().min(1).max(5)});function R(){var e;let[r,a]=(0,l.useState)(!0),[i,m]=(0,l.useState)(null),[h,g]=(0,l.useState)(null),[y,R]=(0,l.useState)(null),S=(0,o.createClientComponentClient)(),{toast:P}=(0,x.dj)(),{t:z}=(0,k.o)(),J=(0,t.mN)({resolver:(0,n.u)(E),defaultValues:{username:"",phone_number:"",phone_public:!1,speed:3,pace:3,power:3}}),I=(J.watch("speed")+J.watch("pace")+J.watch("power"))/3;(0,l.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await S.auth.getUser();if(!e)return;let{data:r}=await S.from("profiles").select("*").eq("id",e.id).single(),{data:a}=await S.from("match_ratings").select("rating").eq("rated_player_id",e.id);if(r&&(m(r),J.reset({username:r.username||"",phone_number:r.phone_number||"",phone_public:r.phone_public||!1,speed:r.speed||3,pace:r.pace||3,power:r.power||3}),a&&a.length>0)){let e=a.reduce((e,r)=>e+r.rating,0)/a.length;R(Number(e.toFixed(1)))}}catch(e){console.error("Error fetching profile:",e)}finally{a(!1)}})()},[]);let B=async e=>{try{var r;let{data:{user:a}}=await S.auth.getUser();if(!a)return;let s=null===(r=e.name.split(".").pop())||void 0===r?void 0:r.toLowerCase();if(!s||!["jpg","jpeg","png","gif"].includes(s))throw Error("Invalid file type. Please upload a JPG, PNG, or GIF image.");let l=await (0,C.A)(e,{maxSizeMB:1,maxWidthOrHeight:800,useWebWorker:!0}),t="".concat(a.id,".").concat(s);await S.storage.from("avatars").remove([t]);let{error:n}=await S.storage.from("avatars").upload(t,l,{upsert:!0,contentType:"image/".concat(s)});if(n)throw n;let{data:{publicUrl:o}}=S.storage.from("avatars").getPublicUrl(t);await S.from("profiles").update({avatar_url:o}).eq("id",a.id),m({...i,avatar_url:o}),P({title:"Success",description:"Profile picture updated"})}catch(e){console.error("Error uploading avatar:",e),P({title:"Error",description:e instanceof Error?e.message:"Failed to upload profile picture",variant:"destructive"})}},M=async e=>{try{let{data:{user:r}}=await S.auth.getUser();if(!r)return;let{data:a,error:s}=await S.from("profiles").select("id").eq("username",e.username).neq("id",r.id);if(s)throw s;if(a&&a.length>0){J.setError("username",{type:"manual",message:"Username is already taken"});return}let{error:l}=await S.from("profiles").update({username:e.username,phone_number:e.phone_number,phone_public:e.phone_public,speed:e.speed,pace:e.pace,power:e.power}).eq("id",r.id);if(l)throw l;P({title:"Success",description:"Profile updated successfully"})}catch(e){console.error("Error updating profile:",e),P({title:"Error",description:"Failed to update profile",variant:"destructive"})}};return r?(0,s.jsx)("div",{className:"p-4",children:"Loading..."}):(0,s.jsx)("div",{className:"p-4 space-y-6",children:(0,s.jsxs)(j.Zp,{children:[(0,s.jsx)(j.aR,{children:(0,s.jsx)(j.ZB,{children:z("profile.title")})}),(0,s.jsxs)(j.Wu,{className:"space-y-6",children:[(0,s.jsx)("div",{className:"flex flex-col items-center",children:(0,s.jsxs)("div",{className:"relative group cursor-pointer",children:[(0,s.jsxs)(v,{className:"h-24 w-24",children:[(0,s.jsx)(b,{src:null==i?void 0:i.avatar_url}),(0,s.jsx)(N,{children:(null==i?void 0:null===(e=i.full_name)||void 0===e?void 0:e[0])||"?"})]}),(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center rounded-full bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,s.jsx)("label",{htmlFor:"avatar-upload",className:"text-xs text-white cursor-pointer",children:z("profile.changePhoto")})}),(0,s.jsx)("input",{id:"avatar-upload",type:"file",accept:"image/*",className:"hidden",onChange:e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];a&&B(a)}})]})}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:z("profile.fullName")}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:(null==i?void 0:i.full_name)||z("profile.notSet")})]}),(0,s.jsx)(d.lV,{...J,children:(0,s.jsxs)("form",{onSubmit:J.handleSubmit(M),className:"space-y-4",children:[(0,s.jsx)(d.zB,{control:J.control,name:"username",render:e=>{let{field:r}=e;return(0,s.jsxs)(d.eI,{children:[(0,s.jsx)(d.lR,{children:z("profile.username")}),(0,s.jsx)(d.MJ,{children:(0,s.jsx)(u.p,{placeholder:"Enter username",...r})}),(0,s.jsx)(d.C5,{})]})}}),(0,s.jsx)(d.zB,{control:J.control,name:"phone_number",render:e=>{let{field:r}=e;return(0,s.jsxs)(d.eI,{children:[(0,s.jsx)(d.lR,{children:z("profile.phoneNumber.label")}),(0,s.jsx)(d.MJ,{children:(0,s.jsx)(u.p,{placeholder:z("profile.phoneNumber.placeholder"),...r})}),(0,s.jsx)(d.C5,{})]})}}),(0,s.jsx)(d.zB,{control:J.control,name:"phone_public",render:e=>{let{field:r}=e;return(0,s.jsxs)(d.eI,{className:"flex items-center justify-between rounded-lg border p-4",children:[(0,s.jsxs)("div",{className:"space-y-0.5",children:[(0,s.jsx)(d.lR,{className:"text-base",children:z("profile.sharePhone")}),(0,s.jsx)(d.Rr,{children:z("profile.sharePhoneDesc")})]}),(0,s.jsx)(d.MJ,{children:(0,s.jsx)(p.d,{checked:r.value,onCheckedChange:r.onChange})})]})}}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(w.J,{children:z("profile.ratings.speed.value").replace("{value}",J.watch("speed").toString())}),(0,s.jsx)(d.zB,{control:J.control,name:"speed",render:e=>{let{field:r}=e;return(0,s.jsx)(d.eI,{children:(0,s.jsx)(d.MJ,{children:(0,s.jsx)(f,{min:1,max:5,step:1,value:[r.value],onValueChange:e=>{let[a]=e;return r.onChange(a)}})})})}})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(w.J,{children:z("profile.ratings.pace.value").replace("{value}",J.watch("pace").toString())}),(0,s.jsx)(d.zB,{control:J.control,name:"pace",render:e=>{let{field:r}=e;return(0,s.jsx)(d.eI,{children:(0,s.jsx)(d.MJ,{children:(0,s.jsx)(f,{min:1,max:5,step:1,value:[r.value],onValueChange:e=>{let[a]=e;return r.onChange(a)}})})})}})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(w.J,{children:z("profile.ratings.power.value").replace("{value}",J.watch("power").toString())}),(0,s.jsx)(d.zB,{control:J.control,name:"power",render:e=>{let{field:r}=e;return(0,s.jsx)(d.eI,{children:(0,s.jsx)(d.MJ,{children:(0,s.jsx)(f,{min:1,max:5,step:1,value:[r.value],onValueChange:e=>{let[a]=e;return r.onChange(a)}})})})}})]}),(0,s.jsxs)("div",{className:"pt-2 border-t",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("p",{className:"font-medium",children:z("profile.selfRating")}),(0,s.jsx)("p",{className:"text-lg font-semibold",children:I.toFixed(1)})]}),y?(0,s.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,s.jsx)("p",{className:"font-medium",children:z("profile.communityRating")}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)(_,{rating:y}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:z("profile.basedOnFeedback")})]})]}):(0,s.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,s.jsx)("p",{className:"font-medium",children:z("profile.communityRating")}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:z("profile.noRatingsYet")})]})]})]}),(0,s.jsx)(c.$,{type:"submit",className:"w-full",children:z("profile.updateProfile")})]})})]})]})})}}},e=>{var r=r=>e(e.s=r);e.O(0,[184,348,451,145,441,517,358],()=>r(8042)),_N_E=e.O()}]);