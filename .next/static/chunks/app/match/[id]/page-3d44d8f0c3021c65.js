(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[733],{586:function(e,t,a){Promise.resolve().then(a.bind(a,2207))},2207:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Z}});var s=a(7437),r=a(2265),i=a(9314),n=a(3082),l=a(5750),c=a(6141),d=a(6142),o=a(2741),m=a(6224),h=a(9764),u=a(9581),p=a(6110),x=a(9155),f=a(3023),g=a(7309),j=a(2621),y=a(2069),v=a(3775),N=a(1908),w=a(4033),_=a(5340);function b(e){let{matchId:t,playerId:a,playerName:i,existingRating:l,onRated:c}=e,[d,o]=(0,r.useState)(l||0),[m,h]=(0,r.useState)(0),[u,p]=(0,r.useState)(!1),x=(0,n.createClientComponentClient)(),{toast:g}=(0,j.pm)(),y=async()=>{try{p(!0);let{data:{user:e}}=await x.auth.getUser();if(!e)return;let{error:s}=await x.from("match_ratings").upsert({match_id:t,rated_player_id:a,rater_id:e.id,rating:d});if(s)throw s;g({title:"Success",description:"Rating submitted successfully"}),null==c||c()}catch(e){console.error("Error submitting rating:",e),g({title:"Error",description:"Failed to submit rating",variant:"destructive"})}finally{p(!1)}};return(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:i}),(0,s.jsx)("div",{className:"flex gap-1 mt-1",children:[1,2,3,4,5].map(e=>(0,s.jsx)("button",{className:"focus:outline-none",onMouseEnter:()=>h(e),onMouseLeave:()=>h(0),onClick:()=>o(e),children:(0,s.jsx)(_.Z,{className:"h-6 w-6 ".concat(e<=(m||d)?"fill-primary text-primary":"text-muted-foreground")})},e))})]}),(0,s.jsx)(f.z,{size:"sm",disabled:!d||u,onClick:y,children:u?"Submitting...":"Submit"})]})}var k=a(9126);function C(e){let{className:t=""}=e;return(0,s.jsx)("div",{className:"relative w-full h-48 bg-gradient-to-b from-primary/20 to-background overflow-hidden ".concat(t),children:(0,s.jsxs)("svg",{className:"absolute inset-0 w-full h-full opacity-[0.15]",viewBox:"0 0 800 400",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{x:"20",y:"20",width:"760",height:"360",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"400",cy:"200",r:"70",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("line",{x1:"400",y1:"20",x2:"400",y2:"380",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"20",y:"120",width:"100",height:"160",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"20",y:"160",width:"50",height:"80",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"120",cy:"200",r:"2",fill:"currentColor"}),(0,s.jsx)("rect",{x:"680",y:"120",width:"100",height:"160",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"730",y:"160",width:"50",height:"80",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"680",cy:"200",r:"2",fill:"currentColor"}),(0,s.jsx)("path",{d:"M20,40 A20,20 0 0,1 40,20",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M760,40 A20,20 0 0,0 780,20",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20,360 A20,20 0 0,0 40,380",stroke:"currentColor",fill:"none",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M760,360 A20,20 0 0,1 780,380",stroke:"currentColor",fill:"none",strokeWidth:"2"})]})})}var E=a(9853),S=a(1213);function Z(e){var t;let{params:a}=e,[_,Z]=(0,r.useState)(null),[z,M]=(0,r.useState)(!0),[F,R]=(0,r.useState)(!1),[W,q]=(0,r.useState)(!1),[P,A]=(0,r.useState)(""),[I,U]=(0,r.useState)(!1),[Y,D]=(0,r.useState)(!1),H=(0,n.createClientComponentClient)(),{toast:L}=(0,j.pm)(),O=(0,w.useRouter)(),[J,T]=(0,r.useState)(null),[Q,$]=(0,r.useState)({}),{t:B}=(0,E.useLanguage)();(0,r.useEffect)(()=>{let e=async()=>{let{data:{user:e}}=await H.auth.getUser();T(e)};e()},[]);let V=async()=>{try{let{data:{user:e}}=await H.auth.getUser();if(!e)return;let{data:t,error:s}=await H.from("matches").select("\n          *,\n          venue:venues(*),\n          host:profiles!matches_host_id_fkey(*),\n          participants:match_participants(\n            player:profiles(*)\n          ),\n          match_ratings(*)\n        ").eq("id",a.id).single();if(s)throw s;Z(t),q(t.host_id===e.id),R(t.participants.some(t=>t.player.id===e.id));let r=t.participants.map(e=>e.player.id),{data:i}=await H.from("match_ratings").select("rating, rated_player_id").in("rated_player_id",r),n={};null==i||i.forEach(e=>{n[e.rated_player_id]||(n[e.rated_player_id]=[]),n[e.rated_player_id].push(e.rating)});let l={};Object.entries(n).forEach(e=>{let[t,a]=e,s=a.reduce((e,t)=>e+t,0)/a.length;l[t]=Number(s.toFixed(1))}),$(l)}catch(e){console.error("Error fetching match:",e)}finally{M(!1)}};(0,r.useEffect)(()=>{J&&V()},[a.id,J]);let G=async()=>{try{let{data:{user:e}}=await H.auth.getUser();if(!e)return;let t=new Date(_.match_date),s=(0,y.Z)(t,-8),r=new Date;if(!(0,v.Z)(r,s)){L({title:"Cannot Cancel",description:"Cancellations are only allowed up to 8 hours before the match",variant:"destructive"});return}let{error:i}=await H.from("match_participants").delete().match({match_id:_.id,player_id:e.id});if(i)throw i;R(!1),L({title:"Success",description:"You've cancelled your participation"});let{data:n,error:l}=await H.from("matches").select("\n          *,\n          venue:venues(*),\n          host:profiles!matches_host_id_fkey(*),\n          participants:match_participants(\n            player:profiles(\n              id,\n              full_name,\n              phone_number,\n              phone_public,\n              avatar_url\n            )\n          )\n        ").eq("id",a.id).single();if(l)throw l;Z(n)}catch(e){console.error("Error cancelling participation:",e),L({title:"Error",description:"Failed to cancel participation",variant:"destructive"})}},K=async()=>{try{if(_.private_code!==P){L({title:"Invalid Code",description:"The code you entered is incorrect",variant:"destructive"});return}let{data:{user:e}}=await H.auth.getUser();if(!e)return;let{error:t}=await H.from("match_participants").insert({match_id:_.id,player_id:e.id});if(t)throw t;R(!0),U(!1),L({title:"Success",description:"You've joined the match!"})}catch(e){console.error("Error joining match:",e),L({title:"Error",description:"Failed to join match",variant:"destructive"})}},X=async()=>{try{let e=window.confirm("Are you sure you want to delete this match? This action cannot be undone.");if(!e)return;let{error:t}=await H.from("match_participants").delete().eq("match_id",_.id);if(t)throw t;let{error:a}=await H.from("matches").delete().eq("id",_.id);if(a)throw a;L({title:"Success",description:"Match has been deleted"}),O.push("/")}catch(e){console.error("Error deleting match:",e),L({title:"Error",description:"Failed to delete match",variant:"destructive"})}},ee=async()=>{try{let e=window.confirm("Are you sure you want to mark this match as finished?");if(!e)return;let{error:t}=await H.from("matches").update({status:"finished"}).eq("id",_.id);if(t)throw t;L({title:"Success",description:"Match has been marked as finished"}),await V()}catch(e){console.error("Error finishing match:",e),L({title:"Error",description:"Failed to finish match",variant:"destructive"})}},et=async e=>{try{return await navigator.clipboard.writeText(e),!0}catch(e){return console.error("Failed to copy text: ",e),!1}},ea=async()=>{try{let{data:{user:e}}=await H.auth.getUser();if(!e)return;let{error:t}=await H.from("match_participants").insert({match_id:_.id,player_id:e.id});if(t)throw t;L({title:"Success",description:"You've joined the match!"}),V()}catch(e){console.error("Error joining match:",e),L({title:"Error",description:"Failed to join match",variant:"destructive"})}};if(z)return(0,s.jsx)("div",{className:"p-4",children:"Loading..."});if(!_)return(0,s.jsx)("div",{className:"p-4",children:"Match not found"});let es=new Date(_.match_date),er=(0,S.x)(es,"EEEE d MMM"),ei=(0,i.ZP)(es,"HH:mm"),en=(null===(t=_.participants)||void 0===t?void 0:t.length)||0,el=(0,y.Z)(es,-8),ec=(0,v.Z)(new Date,el),ed=e=>{let[t,...a]=e.split(" ");return"".concat(t," ").concat(a.map(e=>e[0]).join(". "),".")};return(0,s.jsx)("div",{className:"p-4 space-y-6",children:(0,s.jsxs)(p.Zb,{className:"border-none shadow-none",children:[(0,s.jsx)(C,{className:"rounded-t-lg"}),(0,s.jsxs)(p.Ol,{className:"flex flex-row items-center justify-between pb-2 px-4 -mt-8 relative z-10",children:[(0,s.jsxs)("div",{className:"bg-background p-4 rounded-lg shadow-lg",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:_.venue.name}),(0,s.jsxs)("p",{className:"text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),B("matches.host")," ",_.host.full_name]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end gap-2 bg-background p-4 rounded-lg shadow-lg",children:[_.is_private&&(0,s.jsx)(x.C,{variant:"secondary",children:B("matches.private")}),(0,s.jsx)(x.C,{variant:"outline",children:B("matches.status.".concat(_.status))})]})]}),(0,s.jsxs)(p.aY,{className:"space-y-8 px-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"p-4 rounded-lg border space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:B("matches.date")}),(0,s.jsxs)("p",{className:"font-medium flex items-center gap-2",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4"}),er]})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg border space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:B("matches.time")}),(0,s.jsxs)("p",{className:"font-medium flex items-center gap-2",children:[(0,s.jsx)(c.Z,{className:"h-4 w-4"}),ei]})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg border space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:B("matches.details.costPerPlayer")}),(0,s.jsxs)("p",{className:"font-medium flex items-center gap-2",children:[(0,s.jsx)(u.R,{className:"h-4 w-4"}),"â‚¬",_.cost_per_player]})]}),(0,s.jsxs)("div",{className:"p-4 rounded-lg border space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:B("matches.players")}),(0,s.jsxs)("p",{className:"font-medium flex items-center gap-2",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),en," / ",_.max_players]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:B("matches.details.location")}),(0,s.jsx)("a",{href:"https://maps.google.com/?q=".concat(_.venue.address),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary hover:underline",children:B("matches.details.openInMaps")})]}),(0,s.jsx)("div",{className:"p-4 rounded-lg border",children:(0,s.jsxs)("p",{className:"font-medium flex items-center gap-2",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4"}),_.venue.address]})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Players"}),(0,s.jsx)("div",{className:"grid gap-3",children:_.participants.map(e=>{let t=e.player.speed&&e.player.pace&&e.player.power?((e.player.speed+e.player.pace+e.player.power)/3).toFixed(1):null,a=Q[e.player.id];return(0,s.jsx)("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsxs)(g.qE,{className:"h-10 w-10",children:[(0,s.jsx)(g.F$,{src:e.player.avatar_url}),(0,s.jsx)(g.Q5,{children:e.player.full_name[0]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"font-medium",children:ed(e.player.full_name)}),e.player.id===_.host_id&&(0,s.jsx)(x.C,{variant:"outline",children:"Host"})]}),(0,s.jsxs)("div",{className:"flex gap-3 items-center",children:[t&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Self:"}),(0,s.jsx)(x.C,{variant:"secondary",className:"text-xs",children:t})]}),a&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Community:"}),(0,s.jsx)(k.Z,{rating:a,size:"sm",showValue:!1})]})]}),W&&e.player.phone_public&&e.player.phone_number&&(0,s.jsxs)("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[(0,s.jsx)(o.Z,{className:"h-3 w-3"}),e.player.phone_number]})]})]})},e.player.id)})})]}),!W&&"finished"!==_.status&&(0,s.jsxs)(s.Fragment,{children:[!F&&en<_.max_players&&(0,s.jsx)(s.Fragment,{children:_.is_private&&!I?(0,s.jsx)(f.z,{className:"w-full",onClick:()=>U(!0),children:B("matches.details.joinPrivate")}):_.is_private&&I?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(N.I,{type:"text",placeholder:B("matches.details.enterCode"),maxLength:6,value:P,onChange:e=>A(e.target.value)}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(f.z,{className:"flex-1",onClick:K,children:B("matches.details.submitCode")}),(0,s.jsx)(f.z,{variant:"outline",onClick:()=>{U(!1),A("")},children:"Cancel"})]})]}):(0,s.jsx)(f.z,{className:"w-full",onClick:ea,children:"Join Match"})}),F&&(0,s.jsx)(f.z,{variant:"destructive",className:"w-full",onClick:G,disabled:!ec,children:B(ec?"matches.details.cancelParticipation":"matches.details.cannotCancel")})]}),W&&"finished"!==_.status&&en/_.max_players<.9&&(0,s.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,s.jsx)(f.z,{variant:"destructive",className:"w-full",onClick:X,children:B("matches.details.deleteMatch")}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mt-2 text-center",children:B("matches.details.deleteWarning")})]}),W&&"upcoming"===_.status&&(0,s.jsx)(f.z,{className:"w-full mt-4",onClick:ee,children:B("matches.details.markAsFinished")}),"finished"===_.status&&J&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Rate Players"}),(0,s.jsx)(f.z,{variant:"outline",onClick:()=>D(!Y),children:Y?"Hide Ratings":"Show Ratings"})]}),Y&&(0,s.jsx)("div",{className:"space-y-3",children:_.participants.filter(e=>e.player.id!==J.id).map(e=>{var t,a;let r=null===(a=_.match_ratings)||void 0===a?void 0:null===(t=a.find(t=>t.rater_id===J.id&&t.rated_player_id===e.player.id))||void 0===t?void 0:t.rating;return(0,s.jsx)(b,{matchId:_.id,playerId:e.player.id,playerName:e.player.full_name,existingRating:r,onRated:V},e.player.id)})})]}),W&&_.is_private&&"finished"!==_.status&&(0,s.jsxs)("div",{className:"mt-2 p-4 bg-muted rounded-lg space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:B("matches.details.privateCode")}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(f.z,{size:"sm",variant:"outline",className:"h-8",onClick:async()=>{let e=await et(_.private_code);e&&L({title:"Copied!",description:"Match code copied to clipboard"})},children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-1"}),B("matches.details.copyCode")]}),(0,s.jsxs)(f.z,{size:"sm",variant:"outline",className:"h-8",onClick:()=>{navigator.share?navigator.share({title:"Join my football match!",text:"Join my match at ".concat(_.venue.name,"! Use code: ").concat(_.private_code),url:window.location.href}).catch(e=>{console.error("Error sharing:",e)}):L({title:"Sharing not supported",description:"Your browser doesn't support sharing",variant:"destructive"})},children:[(0,s.jsx)(h.Z,{className:"h-4 w-4 mr-1"}),B("matches.details.share")]})]})]}),(0,s.jsx)("p",{className:"text-lg font-mono tracking-wider text-center bg-background rounded p-2",children:_.private_code})]})]})]})})}},7309:function(e,t,a){"use strict";a.d(t,{F$:function(){return c},Q5:function(){return d},qE:function(){return l}});var s=a(7437),r=a(2265),i=a(6694),n=a(9311);let l=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.fC,{ref:t,className:(0,n.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...r})});l.displayName=i.fC.displayName;let c=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.Ee,{ref:t,className:(0,n.cn)("aspect-square h-full w-full",a),...r})});c.displayName=i.Ee.displayName;let d=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(i.NY,{ref:t,className:(0,n.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...r})});d.displayName=i.NY.displayName},1908:function(e,t,a){"use strict";a.d(t,{I:function(){return n}});var s=a(7437),r=a(2265),i=a(9311);let n=r.forwardRef((e,t)=>{let{className:a,type:r,...n}=e;return(0,s.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...n})});n.displayName="Input"},9126:function(e,t,a){"use strict";a.d(t,{Z:function(){return i}});var s=a(7437),r=a(5340);function i(e){let{rating:t,showValue:a=!0,size:i="md"}=e,n={sm:"h-4 w-4",md:"h-5 w-5",lg:"h-6 w-6"};return(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(e=>(0,s.jsx)(r.Z,{className:"".concat(n[i]," ").concat(e<=t?"fill-primary text-primary":"text-muted-foreground")},e)),a&&(0,s.jsxs)("span",{className:"ml-2 text-sm text-muted-foreground",children:["(",t,")"]})]})}}},function(e){e.O(0,[952,651,210,684,971,864,744],function(){return e(e.s=586)}),_N_E=e.O()}]);